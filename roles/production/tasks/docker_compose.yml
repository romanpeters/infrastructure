---
- name: Ensure Python dependencies
  pip:
    name:
      - requests
      - docker==6.1.3
      - docker-compose

- name: Copy Docker Compose files
  copy:
    src: "files/{{ item }}/"
    dest: "/home/{{ username }}/production/{{ item }}/"
    owner: "{{ username }}"
    group: "{{ username }}"
  loop: "{{ docker_services }}"

- name: Run Docker Compose
  command: docker compose up -d
  args:
    chdir: "/home/{{ username }}/production/{{ item }}"
  loop: "{{ docker_services }}"
